# 📸 飞牛 OS 照片去重工具

## 🎯 功能说明

检测并删除飞牛 OS (`192.168.12.200`) 上 `/vol3/1000/magic6 手机备份` 目录中的重复照片和视频文件。

### 核心功能

- ✅ 递归扫描所有子目录
- ✅ 支持格式：JPG, PNG, GIF, WEBP, HEIC, MP4, MOV, AVI, MKV 等
- ✅ 双重检测：文件大小 + MD5 哈希值
- ✅ 智能保留：自动保留最早创建的文件
- ✅ 安全模式：先预览，后删除（二次确认）
- ✅ 生成报告：保存详细的去重报告

---

## 🚀 使用方法

### 方式 1: 直接运行 Python 脚本

```bash
cd /root/.openclaw/workspace
python3 fn_dedup_photos.py
```

### 方式 2: 使用启动脚本

```bash
bash /root/.openclaw/workspace/fn_dedup.sh
```

---

## 📋 运行流程

### 步骤 1: 连接飞牛 OS
```
📡 正在连接飞牛 OS...
✅ 已连接到 192.168.12.200
✅ 目录存在：/vol3/1000/magic6 手机备份
```

### 步骤 2: 扫描文件
```
📂 开始扫描目录：/vol3/1000/magic6 手机备份
进度：[████████████████████] 10000/10000 (100.0%)
✅ 共扫描到 10000 个照片/视频文件
```

### 步骤 3: 查找重复
```
📊 计算文件哈希值...
进度：[████████████████████] 5000/5000 (100.0%)
📊 发现 150 组重复文件
📊 重复文件数量：320
💾 可释放空间：1250.50 MB
```

### 步骤 4: 预览（安全模式）
```
【预览模式】删除重复文件
1. 🗑️  将删除：/vol3/1000/magic6 手机备份/IMG_001.jpg
   大小：2.50 MB, 时间：2024-05-01 10:30:00
   保留：/vol3/1000/magic6 手机备份/DCIM/IMG_001.jpg
...
```

### 步骤 5: 确认删除
```
是否删除这些重复文件？(y/n): y
⚠️  二次确认：此操作不可恢复！
输入 'YES' 确认删除：YES
✅ 已删除：320 个文件
✅ 已释放空间：1250.50 MB
```

---

## 📁 输出文件

### 日志报告
位置：`/tmp/fn_dedup_logs/dedup_report_YYYYMMDD_HHMMSS.txt`

内容包含：
- 扫描目录
- 重复组数
- 重复文件列表
- MD5 哈希值
- 文件大小和时间

---

## ⚠️ 注意事项

1. **备份重要数据**：删除操作不可恢复，建议先备份
2. **预览模式**：首次运行建议使用预览模式（输入 `n` 不删除）
3. **网络稳定**：确保到飞牛 OS 的 SSH 连接稳定
4. **权限检查**：确保 SSH 账号有删除文件权限

---

## 🔧 配置参数

编辑 `fn_dedup_photos.py` 修改以下参数：

```python
FN_HOST = "192.168.12.200"        # 飞牛 OS IP
FN_USER = "caihong"               # SSH 用户名
FN_PASS = "Www199054@@"           # SSH 密码
REMOTE_PATH = "/vol3/1000/magic6 手机备份"  # 扫描目录
LOCAL_LOG_DIR = "/tmp/fn_dedup_logs"       # 日志目录
```

---

## 📊 支持的文件格式

### 图片
`.jpg`, `.jpeg`, `.png`, `.gif`, `.bmp`, `.webp`, `.heic`, `.heif`

### 视频
`.mp4`, `.mov`, `.avi`, `.mkv`, `.wmv`, `.flv`, `.m4v`

---

## 🛡️ 安全特性

1. **双重确认**：需要两次确认才会删除
2. **保留最早**：自动保留修改时间最早的文件
3. **详细日志**：所有操作都有记录
4. **预览模式**：可以先查看哪些文件会被删除
5. **错误处理**：删除失败会跳过并记录

---

## 📝 示例输出

```
============================================================
  统计结果
============================================================
📊 重复文件总数：320
💾 可释放空间：1250.50 MB
✅ 实际删除：320 个文件
✅ 已释放空间：1250.50 MB

📄 报告已保存：/tmp/fn_dedup_logs/dedup_report_20260224_183045.txt

============================================================
  ✅ 操作完成
============================================================
```

---

## 🆘 故障排除

### 问题 1: 连接失败
```
❌ 连接失败：Connection timed out
```
**解决**：检查飞牛 OS 是否开机，SSH 是否启用

### 问题 2: 权限不足
```
❌ 删除失败：Permission denied
```
**解决**：确保 SSH 账号有文件删除权限

### 问题 3: 目录不存在
```
❌ 目录不存在：/vol3/1000/magic6 手机备份
```
**解决**：检查路径是否正确，注意中文字符

---

## 📞 技术支持

如有问题，请检查：
1. 飞牛 OS SSH 服务状态
2. 网络连接是否正常
3. 文件权限设置
4. 日志文件内容

---

*创建时间：2026-02-24*
*版本：1.0*
