# AntBox 矿机冷却系统监控平台 - 使用指南

**版本**: 1.0.0  
**最后更新**: 2026-02-25  
**适用对象**: 系统管理员、运维工程师、最终用户

---

## 📖 目录

1. [快速入门](#1-快速入门)
2. [系统登录](#2-系统登录)
3. [主仪表盘](#3-主仪表盘)
4. [站点扫描](#4-站点扫描)
5. [设备详情](#5-设备详情)
6. [告警管理](#6-告警管理)
7. [数据查询](#7-数据查询)
8. [系统设置](#8-系统设置)
9. [常见问题](#9-常见问题)
10. [最佳实践](#10-最佳实践)

---

## 1. 快速入门

### 1.1 访问系统

打开浏览器，访问以下地址：

```
主仪表盘：https://192.168.0.57:8443/dashboard.html
站点扫描：https://192.168.0.57:8443/pages/scan.html
设备详情：https://192.168.0.57:8443/pages/device_detail.html?id=设备IP
```

> **注意**：首次访问时，浏览器可能会提示证书不安全（自签名证书），点击"继续访问"即可。

### 1.2 界面概览

```
┌─────────────────────────────────────────────────────────┐
│  🌡️ AntBox 矿机冷却监控系统          [导航菜单]        │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌────────┐ │
│  │ 总站点   │  │ 在线站点 │  │ 总算力   │  │ 总功耗 │ │
│  │   150    │  │    41    │  │  0 EH/s  │  │ 0 MW   │ │
│  └──────────┘  └──────────┘  └──────────┘  └────────┘ │
│                                                         │
│  ┌─────────────────────────┐  ┌──────────────────────┐ │
│  │     温度趋势图表        │  │     告警列表         │ │
│  │                         │  │                      │ │
│  │   [折线图/柱状图]       │  │  🔴 温度超限 x3      │ │
│  │                         │  │  🟡 设备离线 x5      │ │
│  └─────────────────────────┘  └──────────────────────┘ │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

### 1.3 核心功能

| 功能 | 入口 | 用途 |
|------|------|------|
| 查看总览 | 主仪表盘 | 快速了解系统运行状态 |
| 扫描设备 | 站点扫描 | 发现网络中的 AntBox/矿机 |
| 查看详情 | 设备详情 | 查看单个设备的详细信息 |
| 管理告警 | 告警列表 | 处理系统告警 |
| 查询数据 | API 接口 | 获取历史数据 |

---

## 2. 系统登录

> **当前版本**：系统暂未启用认证，后续版本将添加用户登录功能。

### 2.1 未来认证方式（计划中）

**用户名/密码登录**：
- 访问任意页面将弹出登录框
- 输入管理员分配的用户名和密码
- 支持"记住我"功能（7 天免登录）

**权限分级**：
- **超级管理员**：所有功能 + 系统设置
- **运维人员**：数据查看 + 设备操作
- **普通用户**：只读访问

---

## 3. 主仪表盘

### 3.1 访问路径

```
https://192.168.0.57:8443/dashboard.html
```

### 3.2 功能模块

#### 3.2.1 关键指标卡片

显示 4 个核心指标：

| 指标 | 说明 | 单位 |
|------|------|------|
| 总站点 | 系统配置的站点总数 | 个 |
| 在线站点 | 当前在线的站点数量 | 个 |
| 总算力 | 所有矿机的总算力 | EH/s |
| 总功耗 | 所有站点的总功耗 | MW |

**数据刷新**：每 60 秒自动刷新

#### 3.2.2 站点状态分布图

饼图展示：
- 🟢 在线站点
- 🔴 离线站点
- 🟡 异常站点

#### 3.2.3 温度趋势图表

折线图展示 24 小时温度变化：
- 供液温度（蓝色）
- 回液温度（红色）
- 环境温度（绿色）

**交互操作**：
- 鼠标悬停查看具体数值
- 拖动缩放时间范围
- 双击重置视图

#### 3.2.4 实时告警列表

显示最近的告警信息：

| 字段 | 说明 |
|------|------|
| 级别 | 🔴 严重 / 🟡 警告 / 🔵 提示 |
| 站点 | 告警发生的站点名称 |
| 类型 | 温度/功耗/算力/网络 |
| 时间 | 告警触发时间 |
| 状态 | 未确认/已确认/已处理 |

**操作**：
- 点击告警条目 → 跳转到设备详情页
- 点击"确认"按钮 → 标记为已确认
- 点击"处理"按钮 → 标记为已处理

### 3.3 快捷操作

| 按钮 | 功能 |
|------|------|
| 🔄 刷新 | 手动刷新所有数据 |
| 📊 导出 | 导出当前数据为 CSV |
| 🔔 告警 | 查看完整告警列表 |
| ⚙️ 设置 | 进入系统设置 |

---

## 4. 站点扫描

### 4.1 访问路径

```
https://192.168.0.57:8443/pages/scan.html
```

### 4.2 功能说明

站点扫描功能用于发现网络中的 AntBox 冷却设备和矿机，支持批量扫描和智能识别。

### 4.3 使用步骤

#### 步骤 1：配置扫描范围

**方式 A：IP 范围扫描**
```
起始 IP: 10.1.102.1
结束 IP: 10.1.102.254
```

**方式 B：CIDR 格式**
```
网段：10.1.102.0/24
```

**方式 C：批量导入**
1. 点击"批量导入"按钮
2. 上传 CSV/TXT 文件（每行一个 IP）
3. 确认导入

#### 步骤 2：设置扫描参数

| 参数 | 说明 | 推荐值 |
|------|------|--------|
| 并发数 | 同时扫描的 IP 数量 | 50 |
| 超时时间 | 单个 IP 的等待时间（秒） | 2 |
| 设备类型 | 筛选目标设备类型 | 全部 |
| Ping 检测 | 是否先 Ping 检测 | 是 |

#### 步骤 3：启动扫描

点击"开始扫描"按钮，系统将：

1. 生成 IP 列表
2. 执行 Ping 检测（筛选在线设备）
3. 扫描 HTTP 端口（80）
4. 扫描 CGMiner 端口（4028）
5. 识别设备类型
6. 显示结果

#### 步骤 4：查看进度

扫描过程中显示实时进度：

```
进度：████████████░░░░░░░░  65% (165/254)

发现设备:
  ✅ AntBox: 15
  ✅ 矿机：26
  ❌ 离线：124
  ⏳ 扫描中：89
```

#### 步骤 5：处理结果

**结果列表**：

| IP | 类型 | 状态 | 详情 | 操作 |
|----|------|------|------|------|
| 10.1.102.1 | AntBox | 在线 | 温度 25.3°C | [查看详情] |
| 10.1.102.5 | 矿机 | 在线 | 算力 110GH/s | [查看详情] |
| 10.1.102.2 | - | 离线 | - | [Ping 检测] |

**批量操作**：
- 勾选多个设备 → 批量 Ping 检测
- 勾选多个设备 → 批量导入到站点列表
- 点击"导出结果" → 保存为 CSV/Excel

### 4.4 设备识别逻辑

系统通过以下方式识别设备类型：

| 检测方式 | 端口 | 识别特征 | 设备类型 |
|----------|------|----------|----------|
| HTTP 扫描 | 80 | 页面包含"AntBox"/"矿机冷却" | AntBox |
| HTTP 扫描 | 80 | 页面包含"Antminer"/"Whatsminer" | 矿机 |
| CGMiner API | 4028 | 返回 CGMiner 协议数据 | 矿机 |
| Ping 检测 | - | 有响应 | 在线设备 |
| Ping 检测 | - | 无响应 | 离线设备 |

### 4.5 高级功能

#### 4.5.1 保存扫描模板

常用扫描范围可保存为模板：

1. 配置好扫描范围和参数
2. 点击"保存模板"
3. 输入模板名称（如"Zone A 扫描"）
4. 下次使用时从"加载模板"选择

#### 4.5.2 定时扫描（计划中）

支持配置定时任务：

```
扫描频率：每小时 / 每天 / 每周
扫描范围：10.1.102.0/24
通知方式：邮件 / Telegram / 微信
```

---

## 5. 设备详情

### 5.1 访问方式

**方式 A：从扫描结果跳转**
- 在扫描结果中点击设备 IP 或"查看详情"按钮

**方式 B：直接访问**
```
https://192.168.0.57:8443/pages/device_detail.html?id=10.1.102.1
```

**方式 C：从站点列表跳转**
- 在主仪表盘的站点列表中点击站点名称

### 5.2 页面布局

```
┌─────────────────────────────────────────────────────────┐
│  < 返回列表    设备详情：10.1.102.1                     │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  ┌─ 基本信息 ────────────────────────────────────────┐ │
│  │ IP 地址：10.1.102.1        型号：AntBox Pro       │ │
│  │ 位置：Zone A - Rack 01     固件：v2.3.1           │ │
│  │ 状态：🟢 在线             最后更新：1 分钟前      │ │
│  └───────────────────────────────────────────────────┘ │
│                                                         │
│  ┌─ 实时数据 ────────────────────────────────────────┐ │
│  │ 供液温度：25.3°C    回液温度：32.1°C              │ │
│  │ 总功耗：15.2 KW     算力：0 EH/s                  │ │
│  │ 风机转速：65%       压缩机：72%                   │ │
│  └───────────────────────────────────────────────────┘ │
│                                                         │
│  ┌─ Ping 历史（24 小时）──────────────────────────────┐ │
│  │  [折线图：延迟/丢包率]                              │ │
│  └───────────────────────────────────────────────────┘ │
│                                                         │
│  ┌─ 端口扫描 ────────────────────────────────────────┐ │
│  │  80/tcp    ✅ 开放   (HTTP)                        │ │
│  │  4028/tcp  ❌ 关闭   (CGMiner)                     │ │
│  │  443/tcp   ❌ 关闭   (HTTPS)                       │ │
│  └───────────────────────────────────────────────────┘ │
│                                                         │
│  [刷新数据]  [Ping 检测]  [重启设备]  [导出报告]        │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

### 5.3 功能模块

#### 5.3.1 基本信息

| 字段 | 说明 |
|------|------|
| IP 地址 | 设备的 IP 地址 |
| 型号 | 设备型号（AntBox Pro / Antminer S19 等） |
| 位置 | 物理位置描述 |
| 固件 | 固件版本号 |
| 状态 | 在线/离线/异常 |
| 最后更新 | 最后一次数据采集时间 |

#### 5.3.2 实时数据

显示最新采集的运行数据：

| 参数 | 说明 | 正常范围 |
|------|------|----------|
| 供液温度 | 冷却液供给温度 | 20-30°C |
| 回液温度 | 冷却液回流温度 | 30-40°C |
| 总功耗 | 设备总功率 | 根据型号 |
| 算力 | 矿机总算力 | 根据型号 |
| 风机转速 | 冷却风机转速 | 50-80% |
| 压缩机 | 压缩机运行比例 | 60-90% |

**颜色标识**：
- 🟢 绿色：正常范围
- 🟡 黄色：接近阈值
- 🔴 红色：超出阈值

#### 5.3.3 Ping 历史图表

展示 24 小时内的网络连通性：

**图表类型**：
- 折线图 1：Ping 延迟（ms）
- 折线图 2：丢包率（%）

**时间范围**：
- 最近 1 小时
- 最近 6 小时
- 最近 24 小时（默认）
- 最近 7 天

**交互操作**：
- 鼠标悬停查看具体数值
- 拖动选择时间范围
- 滚轮缩放

#### 5.3.4 端口扫描

扫描常用端口的开放状态：

| 端口 | 服务 | 说明 |
|------|------|------|
| 80 | HTTP | Web 管理界面 |
| 443 | HTTPS | 加密 Web 管理 |
| 4028 | CGMiner | 矿机 API |
| 22 | SSH | 远程登录（如有） |

**操作**：
- 点击"重新扫描" → 刷新端口状态

### 5.4 设备操作

#### 5.4.1 Ping 检测

手动触发 Ping 检测：

1. 点击"Ping 检测"按钮
2. 系统发送 4 个 ICMP 包
3. 显示结果（延迟、丢包率）

#### 5.4.2 重启设备（计划中）

> **注意**：此功能需要设备支持远程控制，且存在风险，请谨慎使用。

1. 点击"重启设备"按钮
2. 确认对话框（输入设备 IP 确认）
3. 发送重启命令
4. 等待设备上线（约 2-5 分钟）

#### 5.4.3 导出报告

导出设备详细信息：

1. 点击"导出报告"按钮
2. 选择格式（PDF / CSV / JSON）
3. 下载文件

---

## 6. 告警管理

### 6.1 查看告警

**入口**：主仪表盘 → 实时告警列表 → "查看全部"

**告警列表**：

| 级别 | 站点 | 类型 | 指标值 | 阈值 | 时间 | 状态 |
|------|------|------|--------|------|------|------|
| 🔴 | Zone A-01 | 温度 | 38.5°C | 35°C | 08:45 | 未确认 |
| 🟡 | Zone B-03 | 功耗 | 18.2 KW | 15 KW | 08:30 | 已确认 |
| 🔵 | Zone C-05 | 网络 | 5.2% | 5% | 08:15 | 已处理 |

### 6.2 告警级别

| 级别 | 图标 | 说明 | 通知方式 |
|------|------|------|----------|
| 严重 | 🔴 | 需要立即处理 | Telegram + 微信 + 邮件 |
| 警告 | 🟡 | 需要关注 | Telegram + 微信 |
| 提示 | 🔵 | 信息通知 | 仅系统内显示 |

### 6.3 处理告警

#### 6.3.1 确认告警

1. 点击告警条目的"确认"按钮
2. 可选：填写备注（如"已通知现场人员"）
3. 状态变为"已确认"

#### 6.3.2 处理告警

1. 点击告警条目的"处理"按钮
2. 填写处理结果（如"更换冷却液，温度恢复正常"）
3. 状态变为"已处理"
4. 告警从活动列表移除

#### 6.3.3 批量操作

1. 勾选多个告警
2. 选择"批量确认"或"批量处理"
3. 填写备注（可选）
4. 提交

### 6.4 告警规则配置（计划中）

**入口**：系统设置 → 告警规则

**可配置规则**：

| 规则类型 | 参数 | 默认值 |
|----------|------|--------|
| 温度告警 | 供液温度上限 | 35°C |
| 温度告警 | 回液温度上限 | 45°C |
| 功耗告警 | 功耗波动阈值 | 20% |
| 算力告警 | 算力下限 | 80% 额定值 |
| 网络告警 | 丢包率上限 | 5% |
| 网络告警 | 离线判定次数 | 3 次 |

---

## 7. 数据查询

### 7.1 API 接口

#### 7.1.1 获取仪表盘总览

```bash
curl https://192.168.0.57:8443/api/dashboard/overview
```

**响应**：
```json
{
  "total_sites": 150,
  "online_sites": 41,
  "offline_sites": 109,
  "active_alerts": 8,
  "total_power": 0.00,
  "total_hashrate": 0.00,
  "avg_supply_temp": 0.00
}
```

#### 7.1.2 获取站点列表

```bash
curl "https://192.168.0.57:8443/api/sites?page=1&limit=50"
```

**响应**：
```json
{
  "total": 150,
  "page": 1,
  "limit": 50,
  "sites": [
    {
      "site_id": 1,
      "ip_address": "10.1.102.1",
      "location": "Zone A - Rack 01",
      "is_online": true,
      "last_update": "2026-02-25T08:45:00Z",
      "supply_temp": 25.3,
      "return_temp": 32.1
    }
  ]
}
```

#### 7.1.3 获取趋势数据

```bash
curl "https://192.168.0.57:8443/api/trend/supply_temp?site_id=1&hours=24"
```

**响应**：
```json
{
  "metric": "supply_temp",
  "site_id": 1,
  "data_points": [
    {"timestamp": "2026-02-24T08:00:00Z", "value": 24.5},
    {"timestamp": "2026-02-24T09:00:00Z", "value": 25.1},
    ...
  ]
}
```

#### 7.1.4 Ping 检测

```bash
curl -X POST https://192.168.0.57:8443/api/ping \
  -H "Content-Type: application/json" \
  -d '{"ip": "10.1.102.1"}'
```

**响应**：
```json
{
  "ip": "10.1.102.1",
  "success": true,
  "latency": 1.23,
  "packet_loss": 0.0,
  "ttl": 64
}
```

### 7.2 数据导出

#### 7.2.1 导出站点数据（CSV）

```bash
curl "https://192.168.0.57:8443/api/sites/export?format=csv" \
  -o sites_export.csv
```

#### 7.2.2 导出历史数据（Excel）

```bash
curl "https://192.168.0.57:8443/api/trend/export?site_id=1&metric=supply_temp&days=7" \
  -o trend_export.xlsx
```

---

## 8. 系统设置

### 8.1 访问方式

> **注意**：系统设置功能需要管理员权限（后续版本添加）。

**入口**：主仪表盘 → 右上角齿轮图标

### 8.2 配置项

#### 8.2.1 采集配置

| 参数 | 说明 | 当前值 |
|------|------|--------|
| 采集周期 | 数据采集间隔（秒） | 60 |
| 并发数 | 最大并发请求数 | 50 |
| 超时时间 | 请求超时（秒） | 5 |
| 重试次数 | 失败重试次数 | 3 |

#### 8.2.2 通知配置

| 参数 | 说明 | 当前值 |
|------|------|--------|
| Telegram Bot | Bot Token | 已配置 |
| Telegram Chat | 聊天 ID | 已配置 |
| 微信企业 ID | Corp ID | 未配置 |
| 邮件服务器 | SMTP 地址 | 未配置 |

#### 8.2.3 站点管理

**添加站点**：
1. 点击"添加站点"
2. 填写信息（IP、位置、型号）
3. 保存

**批量导入**：
1. 点击"批量导入"
2. 上传 CSV 文件
3. 预览并确认

**CSV 格式**：
```csv
ip,location,model
10.1.102.1,Zone A - Rack 01,AntBox Pro
10.1.102.2,Zone A - Rack 02,AntBox Pro
```

---

## 9. 常见问题

### Q1: 页面无法访问

**问题**：浏览器显示"无法访问此网站"

**原因**：
- 服务器未启动
- 防火墙阻止访问
- SSL 证书问题

**解决方案**：
1. 检查服务状态：
   ```bash
   sudo systemctl status antmonitor.service
   ```
2. 检查防火墙：
   ```bash
   sudo ufw status
   sudo ufw allow 8443/tcp
   ```
3. 如果是 SSL 证书问题，点击"高级" → "继续访问"

### Q2: 数据显示为 0

**问题**：仪表盘显示总算力、总功耗为 0

**原因**：
- 设备不可达（IP 地址错误）
- 设备 API 接口变更
- 采集脚本未运行

**解决方案**：
1. 使用站点扫描功能检测设备连通性
2. 手动访问设备 IP，确认 WebUI 可访问
3. 检查采集日志：
   ```bash
   sudo journalctl -u antmonitor.service -f
   ```

### Q3: 扫描任务卡住

**问题**：扫描进度长时间停滞

**原因**：
- 某些 IP 无响应，导致阻塞
- 并发数过高，系统资源不足

**解决方案**：
1. 点击"停止扫描"
2. 降低并发数（建议 30-50）
3. 缩短超时时间（建议 2 秒）
4. 重新扫描

### Q4: 告警通知收不到

**问题**：系统触发告警，但未收到 Telegram/微信通知

**原因**：
- Bot Token 配置错误
- 服务器无法访问 Telegram（网络限制）
- Chat ID 错误

**解决方案**：
1. 检查 `alert_notifier.py` 中的配置
2. 测试 Telegram Bot：
   ```bash
   curl "https://api.telegram.org/bot<YOUR_TOKEN>/getUpdates"
   ```
3. 查看系统日志：
   ```bash
   sudo journalctl -u antmonitor.service -f | grep notify
   ```

### Q5: 数据库连接失败

**问题**：API 返回"Database connection error"

**原因**：
- PostgreSQL 未启动
- 数据库密码错误
- 连接池耗尽

**解决方案**：
1. 检查数据库状态：
   ```bash
   sudo systemctl status postgresql
   ```
2. 重启数据库：
   ```bash
   sudo systemctl restart postgresql
   ```
3. 检查连接数：
   ```sql
   SELECT count(*) FROM pg_stat_activity;
   ```

---

## 10. 最佳实践

### 10.1 日常巡检

**每日检查**（建议上午 9 点）：
1. 查看主仪表盘，确认无严重告警
2. 检查在线站点数量（正常应 > 90%）
3. 查看温度趋势，确认无异常波动
4. 处理未确认的告警

**每周检查**（建议周一）：
1. 执行一次全站扫描
2. 导出上周数据报表
3. 清理 30 天前的历史数据
4. 检查系统日志，排查潜在问题

**每月检查**（建议月初）：
1. 备份数据库
2. 更新系统补丁
3. 审查告警规则，优化阈值
4. 生成月度运行报告

### 10.2 性能优化

**数据库优化**：
```sql
-- 定期清理旧数据
DELETE FROM status_snapshots WHERE timestamp < NOW() - INTERVAL '30 days';

-- 重建索引
REINDEX DATABASE antmonitor_db;

-- 分析表
ANALYZE;
```

**系统优化**：
```bash
# 调整文件描述符限制
ulimit -n 65535

# 调整 TCP 参数
echo "net.core.somaxconn = 65535" >> /etc/sysctl.conf
sysctl -p
```

### 10.3 故障排查流程

```
1. 确认故障现象
   ↓
2. 查看系统日志 (journalctl -u antmonitor.service)
   ↓
3. 检查数据库连接 (psql -U antmonitor -d antmonitor_db)
   ↓
4. 检查网络连通性 (ping 设备 IP)
   ↓
5. 检查设备状态 (访问设备 WebUI)
   ↓
6. 根据日志定位问题
   ↓
7. 执行修复操作
   ↓
8. 验证修复结果
   ↓
9. 记录故障报告
```

### 10.4 备份策略

**数据库备份**：
```bash
# 每日备份（cron 任务）
0 2 * * * pg_dump -U antmonitor antmonitor_db > /backup/antmonitor_$(date +\%Y\%m\%d).sql

# 保留 30 天
0 3 * * * find /backup -name "antmonitor_*.sql" -mtime +30 -delete
```

**配置文件备份**：
```bash
# 备份配置目录
tar -czf /backup/config_$(date +%Y%m%d).tar.gz /home/caihong/antmonitor/config/
```

### 10.5 安全建议

1. **修改默认密码**：部署后立即修改数据库密码
2. **启用 HTTPS**：生产环境必须使用 HTTPS
3. **限制访问 IP**：防火墙仅允许信任的 IP 访问
4. **定期更新**：及时更新系统补丁和依赖包
5. **日志审计**：定期检查系统日志，发现异常行为

---

<div align="center">

**AntBox 矿机冷却系统监控平台 - 使用指南**

版本：1.0.0 | 最后更新：2026-02-25

如有问题，请联系：Rainbow (彩虹)

</div>
